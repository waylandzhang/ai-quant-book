# 背景知识：中美量化市场差异

> A股和美股在交易规则、市场结构、数据可用性上有显著差异。理解这些差异是开发跨市场策略的前提。

---

## 一、交易规则对比

| 规则 | A股 | 美股 | 港股 |
|-----|-----|-----|-----|
| 交易时间 | 9:30-11:30, 13:00-15:00 | 9:30-16:00 ET | 9:30-12:00, 13:00-16:00 |
| 结算制度 | T+1 | T+1（2024年5月起） | T+2 |
| 涨跌停 | ±10%（创业板±20%） | 无限制 | 无固定涨跌停（有VCM机制） |
| 卖空 | 融券（限制多） | 相对自由 | 仅限指定证券，禁止裸卖空 |
| 最小变动单位 | ¥0.01 | $0.01 | 动态（根据价格区间变化） |
| 交易单位 | 100股整数倍 | 1股 | 证券发行人决定（一手可能不同） |
| 盘前盘后 | 集合竞价 | 有盘前盘后交易 | 市前成交时段 & 收市竞价时段 |
| 主要费率 | 印花税 0.05%（卖出时） | 佣金极低或免佣 | 印花税 0.1%（买卖双方） |

---

## 二、T+1 的策略影响

### 2.1 A股 T+1

**规则**：当日买入的股票，次日才能卖出

**影响**：
- 无法做日内波段
- 无法快速止损
- 隔夜风险无法规避

**应对策略**：
```python
# A股策略需要考虑隔夜持仓
def should_buy(signal, overnight_risk):
    if overnight_risk > threshold:
        return False  # 风险太高不建仓
    return signal > 0
```

### 2.2 美股日内交易

**规则**：
- Pattern Day Trader（PDT）规则
- 账户 < $25,000：5个交易日内最多3次日内交易
- 账户 ≥ $25,000：无限制
- *注：FINRA 已批准修改 PDT 规则，计划将固定金额限制改为更灵活的风险边际（等待 SEC 最终批准）*

**优势**：
- 可做日内策略
- 快速止损
- 利用盘中波动

---

## 三、涨跌停制度

### 3.1 A股涨跌停

| 板块 | 涨跌停幅度 |
|-----|-----------|
| 主板（沪深） | ±10% |
| 创业板 | ±20%（2020年8月起；上市前5日无限制） |
| 科创板 | ±20%（2019年7月起；上市前5日无限制） |
| 北交所 | ±30%（2021年11月起） |
| ST股 | ±5% |

### 3.2 港股波动调节机制 (VCM)

**规则**：
- 旨在缓解极端的盘中波动。
- 恒指/国指成分股：±10%（5分钟内价格偏离）。
- 触发后进入5分钟冷静期，只能在固定价格区间交易。

**影响**：
- 连续涨停/跌停导致无法成交
- 涨停板无法买入（流动性消失）
- 跌停板无法卖出（被动止损失效）

**策略考量**：
```python
# 涨跌停检测
def is_limit_up(price, prev_close, limit=0.10):
    return price >= prev_close * (1 + limit - 0.001)

def is_limit_down(price, prev_close, limit=0.10):
    return price <= prev_close * (1 - limit + 0.001)
```

### 3.3 美股熔断机制

**指数熔断**：
- Level 1 (7%): 暂停15分钟
- Level 2 (13%): 暂停15分钟
- Level 3 (20%): 当日停止交易

**个股熔断**（LULD）：
- 价格偏离过大时暂停5分钟

---

## 四、卖空机制

### 4.1 A股融券

**限制**：
- 需要开通融资融券账户
- 券源有限，热门股难借
- 融券成本高（年化 8-10%）
- 部分股票禁止融券

**实际影响**：
- 做空策略难以实施
- 市场中性策略成本高
- 对冲手段有限

### 4.2 美股卖空

**流程**：
1. 借入股票
2. 卖出
3. 买回还券

**成本**：
- 借券费（0.3% - 50%+ 年化）
- 分红补偿

**Easy-to-Borrow vs Hard-to-Borrow**：
- 大盘股容易借
- 小盘股、热门做空标的难借且贵

---

## 五、数据可用性

### 5.1 A股数据

| 数据类型 | 来源 | 成本 |
|---------|------|-----|
| 日频行情 | Tushare, AKShare | 免费 |
| 分钟数据 | Tushare Pro | 积分制/赞助 (约¥200+) |
| Level-2 | 券商、Wind | ¥10000+/年 |
| 财务数据 | Tushare, Wind | 基本免费-深度付费 |
| 另类数据 | 第三方 | 高价 |

**免费数据源**：
- Tushare Pro：https://tushare.pro (积分制度，活跃社区可免费)
- AKShare：https://akshare.xyz (开源免费，接口丰富)
- BaoStock：http://baostock.com

### 5.2 美股数据

| 数据类型 | 来源 | 成本 |
|---------|------|-----|
| 日频行情 | Yahoo Finance | 免费 |
| 分钟数据 | Alpha Vantage | 免费/付费 |
| Level-2 | Polygon.io | $29-199/月 |
| 财务数据 | SEC EDGAR | 免费 |

---

## 六、市场参与者结构

### 6.1 A股

| 参与者 | 占比 | 特点 |
|-------|------|-----|
| 散户 | ~80%+ (成交量) | 短期交易、情绪驱动、持仓占比约20% |
| 机构 | ~20% (成交量) | 公募、私募、险资、外资(占比上升中) |

**影响**：
- 波动率高
- 动量效应明显
- 情绪驱动价格偏离

### 6.2 美股

| 参与者 | 占比 | 特点 |
|-------|------|-----|
| 机构 | ~70-80% | 养老金、共同基金、对冲基金、高频交易(占成交50%+) |
| 散户 | ~20-25% | 近年因 Robinhood 等上升，"抄底"意愿强 |

**影响**：
- 相对理性
- 因子有效性更持久
- 被动投资占比高

---

## 七、策略差异

### 7.1 A股有效策略

| 策略 | 有效性 | 原因 |
|-----|-------|------|
| 动量 | 强 | 散户跟风、涨停板效应 |
| 小盘股 | 强 | 壳资源价值、流动性溢价 |
| 反转 | 中 | 过度反应后的修正 |
| 价值 | 弱-中 | 散户偏好成长 |

### 7.2 美股有效策略

| 策略 | 有效性 | 原因 |
|-----|-------|------|
| 价值 | 中 | 长期有效但周期性 |
| 动量 | 中 | 机构交易稀释 |
| 质量 | 强 | 长期稳定 |
| 低波动 | 强 | 风险调整收益好 |

---

## 八、技术实现差异

### 8.1 回测注意事项

**A股**：
```python
# A股回测必须考虑的因素
class ChinaBacktester:
    def __init__(self):
        self.t_plus_1 = True  # T+1 限制
        self.limit_up_down = 0.10  # 涨跌停
        self.min_lot = 100  # 最小交易单位

    def can_sell(self, position, trade_date):
        # 检查是否满足 T+1
        return position.buy_date < trade_date

    def check_tradeable(self, price, prev_close):
        # 检查是否涨跌停
        if self.is_limit_up(price, prev_close):
            return False  # 涨停无法买入
        if self.is_limit_down(price, prev_close):
            return False  # 跌停无法卖出
        return True
```

**美股**：
```python
# 美股回测更简单
class USBacktester:
    def __init__(self):
        self.t_plus_0 = True  # 可当日交易
        self.fractional_shares = True  # 可碎股
```

### 8.2 实盘接口

**A股**：
- 券商自有接口（需要申请）
- PTrade、QMT 等程序化接口
- 第三方接口（灰色地带）

**美股**：
- Interactive Brokers API
- Alpaca API
- TD Ameritrade API

---

## 九、监管差异

### 9.1 A股监管

- 证监会、沪深交易所
- 程序化交易需报备
- 异常交易监控严格
- 内幕交易处罚严厉

### 9.2 美股监管

- SEC、FINRA
- 高频交易需注册
- Reg NMS 规范执行
- Pattern Day Trader 规则

---

## 十、实践建议

### 10.1 A股策略开发

1. **考虑 T+1**：策略周期至少隔夜
2. **处理涨跌停**：回测时剔除涨跌停日
3. **注意换手率**：A股换手率高，交易成本累积快
4. **关注政策风险**：政策对 A 股影响大

### 10.2 美股策略开发

1. **注意 PDT 规则**：小账户限制日内交易
2. **考虑盘前盘后**：重大新闻常在盘前盘后发布
3. **借券成本**：做空策略要考虑 Hard-to-Borrow 成本
4. **流动性分层**：大盘股和小盘股流动性差异大

### 10.3 跨市场策略

```python
# 市场规则配置
def get_market_rules(market):
    if market == 'CN':
        return {
            't_plus': 1,
            'limit': 0.10,
            'min_lot': 100,
            'short_available': False
        }
    elif market == 'HK':
        return {
            't_plus': 2,
            'limit': 'VCM',
            'min_lot': 'Varies',
            'short_available': True
        }
    elif market == 'US':
        return {
            't_plus': 0,
            'limit': None,
            'min_lot': 1,
            'short_available': True
        }
```

---

> **核心原则**：不要直接将美股策略套用到 A 股，也不要反过来。每个市场都有独特的规则和参与者结构，策略必须适应本地市场特性。
